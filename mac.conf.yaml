- defaults:
    brewfile:
      stderr: true
      stdout: true
      quiet: false
    brew:
      stderr: true
      stdout: true
      quiet: false
    link:
      create: true
      relink: true
      force: true

- link:
    ~/.amethyst.yml: amethyst/.amethyst.yml

- brewfile:
    - brew/Brewfile

- shell:
    - command: |
        defaults write com.apple.dock workspaces-auto-swoosh -bool NO
        killall Dock
        defaults write -g NSAutomaticWindowAnimationsEnabled -bool false
      stdin: true
      stderr: true
      quiet: false
      description: configure MacOS for TWM
    - command: |
        export GIT_SSH_COMMAND="ssh -o UserKnownHostsFile=/dev/null -o StrictHostKeyChecking=no"
        if ! command git ls-remote git@github.com:Ajibaji/seeshellontheseasaw.git; then
          echo "You aren't me. Nothing to see here"
        else
          if [ ! -d ~/seeshellontheseasaw ]; then
            git clone git@github.com:ajibaji/seeshellontheseasaw.git ~/seeshellontheseasaw
          fi
        fi
        unset GIT_SSH_COMMAND
      stderr: true
      quiet: true
      description: git clone seeshellontheseasaw
    - command: |
        if ! command -v fnm > /dev/null 2>&1; then
          echo "ERROR: ensure FNM is installed and try again"
        fi

        fnm install v20
        fnm install v18
        fnm default v20
      stderr: true
      quiet: false
      description: install nodejs versions
    - command: |
        npm i -g neovim typescript azure-pipelines-language-server typescript-language-server sql-language-server @biomejs/biome
      stdin: true
      stderr: true
      quiet: false
      description: installing npm packages
    - command: |
        launchctl setenv XDG_CONFIG_HOME "$HOME/.config"
      stdin: true
      stderr: true
      quiet: false
      description: setting XDG_CONFIG_HOME
    - command: |
        defaults write com.apple.LaunchServices/com.apple.launchservices.secure LSHandlers \
          -array-add '{LSHandlerContentType=public.plain-text;LSHandlerRoleAll=dev.zed.Zed;}'
      stdin: true
      stderr: true
      quiet: false
      description: Set Neovide as default OS editor
    - command: |
        echo 'podman "$@"' > ~/.local/bin/docker
        chmod +x ~/.local/bin/docker
      stdin: true
      stderr: true
      quiet: false
      description: Docker --> Podman
    - command: |
        if ! command -v python > /dev/null 2>&1; then
          echo 'python3 "$@"' > ~/.local/bin/python
          chmod +x ~/.local/bin/python
        fi
        if ! command -v pip > /dev/null 2>&1; then
          echo 'pip3 "$@"' > ~/.local/bin/pip
          chmod +x ~/.local/bin/pip
        fi
      stdin: true
      stderr: true
      quiet: false
      description: python/pip --> python3/pip3
    - command: |
        if ! command -v eget > /dev/null 2>&1; then
          git clone https://github.com/rjshrjndrn/eget
          cd eget
          go build -trimpath -ldflags "-s -w -X main.Version=1.3.2-dev.23" -o dist/bin/eget .
          sudo mv ./dist/bin/eget /usr/local/bin/eget
          cd -
          rm -rf eget
        fi
      stdin: true
      stderr: true
      quiet: false
      description: installing eget
    - command: |
        # ctrl + cmd to drag windows
        defaults write -g NSWindowShouldDragOnGesture -bool true

        # mission control fix for aerospace
        defaults write com.apple.dock expose-group-apps -bool true && killall Dock

        # disable displays have separate spaces
        defaults write com.apple.spaces spans-displays -bool true && killall SystemUIServer

        # Keyboard: Set a shorter Delay until key repeat
        defaults write -g InitialKeyRepeat -int 15

        # Keyboard: Set a fast keyboard repeat rate
        defaults write -g KeyRepeat -int 2

        # Finder: Show all extenions
        defaults write -g AppleShowAllExtensions -bool true

        # Finder: Show ~/Library in finder
        chflags nohidden ~/Library

        # Trackpad: enable tap to click for this user and for the login screen
        defaults write com.apple.driver.AppleBluetoothMultitouch.trackpad Clicking -int 1
        defaults write com.apple.AppleMultitouchTrackpad Clicking -int 1
        defaults -currentHost write -g com.apple.mouse.tapBehavior -int 1
        defaults write -g com.apple.mouse.tapBehavior -int 1

        # Trackpad: three finger drag
        defaults write com.apple.driver.AppleBluetoothMultitouch.trackpad TrackpadThreeFingerDrag -bool true
        defaults write com.apple.AppleMultitouchTrackpad TrackpadThreeFingerDrag -bool true

        # Global: Enable full keyboard access for all controls
        # (e.g. enable Tab in modal dialogs)
        defaults write -g AppleKeyboardUIMode -int 3

        # Finder: Full POSIX path in finder windows
        defaults write com.apple.finder _FXShowPosixPathInTitle -bool true

        # Finder: Show Status bar in Finder
        defaults write com.apple.finder ShowStatusBar -bool true

        # Finder: Show icons for hard drives, servers, and removable media on the desktop
        defaults write com.apple.finder ShowExternalHardDrivesOnDesktop -bool true
        defaults write com.apple.finder ShowMountedServersOnDesktop -bool true
        defaults write com.apple.finder ShowRemovableMediaOnDesktop -bool true

        # Finder: new windows start at home directory
        defaults write com.apple.finder NewWindowTarget -string PfHm
        defaults write com.apple.finder NewWindowTargetPath -string "file:///$HOME"

        # Finder: only search the current direcotry
        defaults write com.apple.finder FXDefaultSearchScope -string SCcf

        # Mission Control: Don't automatically rearrange Spaces based on most recent use
        defaults write com.apple.dock mru-spaces -bool false

        # Dock: Automatically hide and show the Dock
        defaults write com.apple.dock autohide -bool true

        # Dock: Disable recents
        defaults write com.apple.dock show-recents -bool false

        # Screenshot: Save screenshots with date in filename
        defaults write com.apple.screencapture include-date -bool true

        # Bottom right screen corner â†’ Notes
        defaults write com.apple.dock wvous-br-corner -int 14
      stdin: true
      stderr: true
      quiet: false
      description: MacOS config
